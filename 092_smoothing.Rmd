<style>@import url(style.css);</style>
[Introduction to Data Analysis](index.html "Course index")

# 9.2. Smoothing

To test a few smoothing algorithms, we are going to mimick the [Quandl API][q-api] by scraping and downloading short time .

```{r packages, message=FALSE, warning=FALSE}
# Load packages.
packages <- c("downloader", "ggplot2", "lubridate", "reshape", "scales")
packages <- lapply(packages, FUN = function(x) {
  if(!require(x, character.only = TRUE)) {
    install.packages(x)
    library(x, character.only = TRUE)
  }
})
```

[q-api]: http://www.quandl.com/api

```{r quandl-scrape}
# 
link = "http://www.quandl.com/api/v1/datasets/STATCHINA/E0403.csv?&trim_start=1952-12-31&trim_end=2011-12-31&sort_order=desc"
file = "data/OECD.Murder.rates.txt"
# Download
if(!file.exists(file)) download(link, file, mode = "wb")
# Read data, skipping row numbers.
data <- read.csv(file)
# Fix names.
names(data) <- c("Year", "Active", "Employed", "P1", "P2", "P3",
                 "Primary", "Secondary", "Tertiary")
# Reshape.
data <- melt(data, id = "Year", variable = "Population")
# Turn years to proper dates.
data$Year <- ymd(data$Year)
```

```{r plot}
#
qplot(data = subset(data, Population %in% c("Primary", "Secondary", "Tertiary")),
      y = value / 10^3, x = Year, colour = Population, fill = Population,
      geom = "line") + 
    scale_y_continuous(labels = comma) + labs(y = "Million")
```

```{r plot2}
#
qplot(data = subset(data, Population %in% c("Primary", "Secondary", "Tertiary")),
      y = value / 10^3, x = Year, colour = Population, fill = Population,
      position = "stack", geom = "area") + 
    scale_y_continuous(labels = comma) + labs(y = "Million")
```

Note how the change in smoothing algorithm affects the aspect of the curve for handguns. On the same topic, see [Kieran Healy's plots and code](https://github.com/kjhealy/assault-deaths) on state-by-state trends and the United States vers other OECD countries.

> __Next__: [Practice](093_practice.html).
